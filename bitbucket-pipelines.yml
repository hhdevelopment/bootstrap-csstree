image: node:4.6.0
pipelines:
  default:
    - step:
        script:
          - echo $BITBUCKET_BRANCH
          - npm install
          - npm install gulp-cli -g
          - npm install gulp -D
          - gulp build site
  branches:
    v*:
      - step:
          script:
            - printf "//`node -p \"require('url').parse(process.env.NPM_REGISTRY_URL || 'https://registry.npmjs.org').host\"`/:_authToken=${NPM_TOKEN}\nregistry=${NPM_REGISTRY_URL:-https://registry.npmjs.org}\n" >> ~/.npmrc
            - git config --global push.default matching
            - git config user.email "francois.achache@gmail.com"
            - git config user.name "hhfrancois"
            - npm version $BITBUCKET_BRANCH
            - git fetch origin
            - git branch
            - git checkout master
            - git merge $BITBUCKET_BRANCH
#            - git branch
#            - git push origin $BITBUCKET_BRANCH
#            - npm publish
